<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>نظام إدارة مشتركي الإنترنت</title>
    <style>
        body { font-family: Arial; max-width: 900px; margin: auto; padding: 20px; background-color: #f5f5f5; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        .paid { background-color: #e8f5e9; }
        .unpaid { background-color: #ffebee; }
        .form-group { margin: 15px 0; }
        .form-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button { background-color: #4285f4; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #3367d6; }
        .subscription-badge { 
            padding: 3px 8px; 
            border-radius: 4px; 
            font-weight: bold; 
            font-size: 0.8em;
        }
        .max { background-color: #d1c4e9; color: #4527a0; }
        .plus { background-color: #bbdefb; color: #1565c0; }
        .standard { background-color: #c8e6c9; color: #2e7d32; }
        .nb1 { background-color: #ffccbc; color: #e64a19; }
        .other { background-color: #e0e0e0; color: #424242; }
        #customAmountContainer { display: none; margin-top: 10px; }
        .date-input { width: 150px; }
    </style>
</head>
<body>

<h1 style="color: #4285f4;">إدارة مشتركي الإنترنت</h1>

<div style="display: flex; gap: 20px; margin-bottom: 20px;">
    <!-- قسم إضافة مشترك جديد -->
    <div class="form-container" style="flex: 1;">
        <h2>إضافة مشترك جديد</h2>
        <div class="form-group">
            <label>اسم المشترك:</label>
            <input type="text" id="customerName" style="width: 100%; padding: 8px;">
        </div>
        <div class="form-group">
            <label>نوع الاشتراك:</label>
            <select id="subscriptionType" style="width: 100%; padding: 8px;" onchange="checkSubscriptionType()">
                <option value="nb1">NB1 - 25,000 دينار</option>
                <option value="max">ماكس - 30,000 دينار</option>
                <option value="standard">ستاندرد - 50,000 دينار</option>
                <option value="plus">بلص - 35,000 دينار</option>
                <option value="other">أخرى</option>
            </select>
            <div id="customAmountContainer">
                <label>المبلغ المخصص:</label>
                <input type="number" id="customAmount" style="width: 100%; padding: 8px;">
            </div>
        </div>
        <div class="form-group">
            <label>اسم المسوق:</label>
            <input type="text" id="marketer" style="width: 100%; padding: 8px;">
        </div>
        <div class="form-group">
            <label>عمولة المسوق:</label>
            <input type="number" id="customCommission" style="width: 100%; padding: 8px;" value="0">
        </div>
        <div class="form-group">
            <label>تاريخ الاشتراك:</label>
            <input type="date" id="subscriptionDate" style="padding: 8px;" class="date-input" value="">
        </div>
        <button onclick="addCustomer()">حفظ المشترك</button>
    </div>

    <!-- قسم تسديد الدفعات -->
    <div class="form-container" style="flex: 1;">
        <h2>تسديد دفعة</h2>
        <div class="form-group">
            <label>اختر المشترك:</label>
            <select id="paymentCustomer" style="width: 100%; padding: 8px;"></select>
        </div>
        <div class="form-group">
            <label>المبلغ المدفوع:</label>
            <input type="number" id="paymentAmount" style="width: 100%; padding: 8px;">
        </div>
        <div class="form-group">
            <label>تاريخ الدفعة:</label>
            <input type="date" id="paymentDate" style="padding: 8px;" class="date-input" value="">
        </div>
        <button onclick="addPayment()">تسجيل الدفع</button>
    </div>
</div>

<h2 style="color: #4285f4;">كشف الحسابات</h2>
<table id="customersTable">
    <thead>
        <tr style="background-color: #4285f4; color: white;">
            <th>اسم المشترك</th>
            <th>نوع الاشتراك</th>
            <th>المبلغ</th>
            <th>تاريخ الاشتراك</th>
            <th>الحالة</th>
            <th>المسوق</th>
            <th>عمولة المسوق</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<div class="form-container" style="margin-top: 20px;">
    <h3>إجماليات:</h3>
    <div style="display: flex; gap: 20px;">
        <div style="flex: 1;">
            <p>إجمالي المشتركين: <strong><span id="totalCustomers">0</span></strong></p>
            <p>المسددون: <strong><span id="paidCustomers">0</span></strong></p>
            <p>غير المسددين: <strong><span id="unpaidCustomers">0</span></strong></p>
        </div>
        <div style="flex: 1;">
            <p>إجمالي المبالغ المستحقة: <strong><span id="totalDue">0</span> دينار</strong></p>
            <p>إجمالي المدفوع: <strong><span id="totalPaid">0</span> دينار</strong></p>
            <p>إجمالي المتبقي: <strong><span id="totalRemaining">0</span> دينار</strong></p>
        </div>
        <div style="flex: 1;">
            <p>إجمالي عمولات المسوقين: <strong><span id="totalCommissions">0</span> دينار</strong></p>
        </div>
    </div>
</div>

<script>
// تعريف أنواع الاشتراك مع الأسعار المطلوبة
const subscriptionPlans = {
    nb1: { name: "NB1", price: 25000, commission: 5000 },
    max: { name: "ماكس", price: 30000, commission: 6000 },
    standard: { name: "ستاندرد", price: 50000, commission: 10000 },
    plus: { name: "بلص", price: 35000, commission: 7000 },
    other: { name: "أخرى", price: 0, commission: 0 }
};

// البيانات الأساسية
let customers = JSON.parse(localStorage.getItem('internetCustomers')) || [];

// عند تحميل الصفحة
window.onload = function() {
    // تعيين تاريخ اليوم كقيمة افتراضية
    const today = new Date().toISOString().split('T')[0];
    document.getElementById("subscriptionDate").value = today;
    document.getElementById("paymentDate").value = today;
    
    updateCustomersDropdown();
    updateCustomersTable();
};

// عرض/إخفاء حقل المبلغ المخصص
function checkSubscriptionType() {
    const subscriptionType = document.getElementById("subscriptionType").value;
    const customAmountContainer = document.getElementById("customAmountContainer");
    
    if (subscriptionType === "other") {
        customAmountContainer.style.display = "block";
    } else {
        customAmountContainer.style.display = "none";
    }
}

// إضافة مشترك جديد
function addCustomer() {
    const subscriptionType = document.getElementById("subscriptionType").value;
    let plan;
    
    if (subscriptionType === "other") {
        const customAmount = parseInt(document.getElementById("customAmount").value) || 0;
        const customCommission = parseInt(document.getElementById("customCommission").value) || 0;
        plan = {
            name: "أخرى",
            price: customAmount,
            commission: customCommission
        };
    } else {
        plan = subscriptionPlans[subscriptionType];
    }
    
    const customer = {
        id: Date.now(),
        name: document.getElementById("customerName").value,
        subscription: subscriptionType,
        customPlan: subscriptionType === "other" ? plan : null,
        marketer: document.getElementById("marketer").value,
        subscriptionDate: document.getElementById("subscriptionDate").value || new Date().toISOString().split('T')[0],
        payments: [],
        paid: false
    };
    
    customers.push(customer);
    saveData();
    updateCustomersDropdown();
    updateCustomersTable();
    clearAddForm();
}

// تسديد دفعة
function addPayment() {
    const customerId = parseInt(document.getElementById("paymentCustomer").value);
    const amount = parseInt(document.getElementById("paymentAmount").value);
    const paymentDate = document.getElementById("paymentDate").value || new Date().toISOString().split('T')[0];
    
    const customer = customers.find(c => c.id === customerId);
    if (customer) {
        customer.payments.push({
            amount: amount,
            date: paymentDate
        });
        
        // تحقق إذا تم السداد بالكامل
        const plan = customer.customPlan || subscriptionPlans[customer.subscription];
        const totalPaid = customer.payments.reduce((sum, p) => sum + p.amount, 0);
        customer.paid = totalPaid >= plan.price;
        
        saveData();
        updateCustomersTable();
        document.getElementById("paymentAmount").value = "";
    }
}

// تحديث القائمة المنسدلة للمشتركين
function updateCustomersDropdown() {
    const dropdown = document.getElementById("paymentCustomer");
    dropdown.innerHTML = customers.map(c => {
        const plan = c.customPlan || subscriptionPlans[c.subscription];
        return `<option value="${c.id}">${c.name} - ${plan.name} (${plan.price} دينار)</option>`;
    }).join("");
}

// تحديث جدول المشتركين
function updateCustomersTable() {
    const tableBody = document.querySelector("#customersTable tbody");
    tableBody.innerHTML = customers.map(customer => {
        const plan = customer.customPlan || subscriptionPlans[customer.subscription];
        const totalPaid = customer.payments.reduce((sum, p) => sum + p.amount, 0);
        const remaining = plan.price - totalPaid;
        const status = customer.paid ? 
            `<span style="color: green;">مسدد بالكامل</span>` : 
            `مدفوع: ${totalPaid} - المتبقي: <span style="color: red;">${remaining}</span>`;
        
        return `
        <tr class="${customer.paid ? 'paid' : 'unpaid'}">
            <td>${customer.name}</td>
            <td><span class="subscription-badge ${customer.subscription === 'other' ? 'other' : customer.subscription}">
                ${plan.name}${customer.customPlan ? ' (مخصص)' : ''}
            </span></td>
            <td>${plan.price.toLocaleString()} دينار</td>
            <td>${customer.subscriptionDate}</td>
            <td>${status}</td>
            <td>${customer.marketer}</td>
            <td>${customer.paid ? plan.commission.toLocaleString() : '0'} دينار</td>
        </tr>`;
    }).join("");
    
    // حساب الإجماليات
    const totalCustomers = customers.length;
    const paidCustomers = customers.filter(c => c.paid).length;
    const unpaidCustomers = totalCustomers - paidCustomers;
    
    const totalDue = customers.reduce((sum, c) => {
        const plan = c.customPlan || subscriptionPlans[c.subscription];
        return sum + plan.price;
    }, 0);
    
    const totalPaid = customers.reduce((sum, c) => 
        sum + c.payments.reduce((s, p) => s + p.amount, 0), 0);
    
    const totalCommissions = customers.filter(c => c.paid)
        .reduce((sum, c) => {
            const plan = c.customPlan || subscriptionPlans[c.subscription];
            return sum + plan.commission;
        }, 0);
    
    document.getElementById("totalCustomers").textContent = totalCustomers;
    document.getElementById("paidCustomers").textContent = paidCustomers;
    document.getElementById("unpaidCustomers").textContent = unpaidCustomers;
    document.getElementById("totalDue").textContent = totalDue.toLocaleString();
    document.getElementById("totalPaid").textContent = totalPaid.toLocaleString();
    document.getElementById("totalRemaining").textContent = (totalDue - totalPaid).toLocaleString();
    document.getElementById("totalCommissions").textContent = totalCommissions.toLocaleString();
}

// حفظ البيانات في localStorage
function saveData() {
    localStorage.setItem('internetCustomers', JSON.stringify(customers));
}

// مسح حقول الإضافة
function clearAddForm() {
    document.getElementById("customerName").value = "";
    document.getElementById("marketer").value = "";
    document.getElementById("customAmount").value = "";
    document.getElementById("customCommission").value = "0";
    document.getElementById("subscriptionType").selectedIndex = 0;
    document.getElementById("customAmountContainer").style.display = "none";
    document.getElementById("subscriptionDate").value = new Date().toISOString().split('T')[0];
    document.getElementById("paymentDate").value = new Date().toISOString().split('T')[0];
}
</script>

</body>
</html>
